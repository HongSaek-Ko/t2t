<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.t2t.prd.repository.ProductMapper">

    <insert id="write"> <!--prdId, hit, datetime 자동부여 / 현재 판매량은 작성 후 증가 / 판매상태, 중단사유는 수정 시 부여-->
        <selectKey resultType="long" keyProperty="prdId" order="AFTER">
            SELECT MAX(PRDID) AS PRDID FROM PRD
        </selectKey>
        INSERT INTO PRD(TITLE, USRID, CONT, TRGTSALQTY, ISLIMIT, CATE, PRICE)
        VALUES(#{title}, #{usrId}, #{cont}, #{trgtSalQty}, #{islimit}, #{cate}, #{price})
    </insert>

    <select id="findByPrdId" resultType="org.t2t.prd.dto.ProductDTO">
        SELECT * FROM PRD
        WHERE PRDID=#{prdId}
    </select>

    <update id="modify">
        UPDATE PRD
        SET TITLE=#{title}, CONT=#{cont}, CATE=#{cate}, SALSTAT=#{salStat}, ABTREAS=#{abtReas}
        WHERE PRDID=#{prdId}
    </update>
    <!--  서비스에서 넘어옴      HashMap 타입의 객체를 매개변수로 받았으므로... 쿼리 결과를 GoodDTO 타입으로 변환-->
    <select id="findGoodById" parameterType="hashmap" resultType="org.t2t.prd.dto.GoodDTO">
        SELECT G.* FROM
            PRD R LEFT OUTER JOIN GOOD G
        ON R.PRDID = G.PRDID <!--테이블 결합 조건. PRD / GOOD 테이블의 PRDID가 일치하는 것만 결합 -->
        WHERE
            G.USRID = #{usrId} <!--매개변수로 전달된 usrId 값과 일치하는 USRID 데이터를 선택; 어떤 사용자가 '좋아요' 누른 것만 조회 -->
    </select>

    <!--'좋아요'를 눌렀다는 정보(데이터)를 삭제; 넘어온 매개변수와 일치하는 레코드를 삭제...-->
    <delete id="deleteGood" parameterType="hashmap" > <!--HashMap 타입의 객체를 매개변수로 보냈으니까...-->
        DELETE FROM GOOD
        WHERE
            PRDID = #{prdId} AND
            USRID = #{usrId}
    </delete>

    <!--'좋아요'를 눌렀다는 정보(데이터)를 저장-->
    <insert id="insertGood" parameterType="hashmap" >
        INSERT INTO GOOD
        (prdId, usrId)
        VALUES
        (#{prdId}, #{usrId})
    </insert>

    <delete id="deleteProduct">
        DELETE FROM PRD
        WHERE PRDID=#{prdId}
    </delete>
</mapper>