<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.t2t.mem.repository.MemberMapper">

    <!-- 회원 1명 정보 조회 -->
    <select id="findByID" resultType="org.t2t.mem.dto.MemberDTO">
        SELECT * FROM MEM WHERE USRID = #{usrId}
    </select>
    <!-- 회원 전체 조회 -->
    <select id="findList" resultType="org.t2t.mem.dto.MemberDTO">
        SELECT * FROM MEM
    </select>
    <!-- 회원정보 수정 -->
    <update id="updateMem">
        UPDATE MEM
            SET BANKNM=#{bankNm},
            EMAIL=#{email},
            INTRO=#{intro},
            PASSWD=#{passwd},
            BANKACNT = #{bankAcnt}
        WHERE
            USRID = #{usrId}
    </update>
    <!-- 회원 탈퇴 -->
    <delete id="deleteMem">
        DELETE FROM MEM
        WHERE USRID = #{usrId}
    </delete>
    <!-- id, pw 일치여부 확인 -->
    <select id="idPwChecking" resultType="org.t2t.mem.dto.MemberDTO">
        SELECT * FROM MEM
        WHERE USRID=#{usrId} AND PASSPW=#{passwd}
    </select>
    <!-- 마일리지 충전 / 환전 -->
    <insert id="updateMile" parameterType="org.t2t.mem.dto.MileDTO">
        UPDATE MILES
        SET POINT =
        <choose>
            <when test="option == 'TRD01'">
                #{point} + POINT
            </when>
            <otherwise>
                POINT - #{point}
            </otherwise>
        </choose>
        WHERE
        USRID = #{usrId}
    </insert>
    <!-- 나의 마일리지 포인트 -->
    <select id="selectMileTotal" resultType="org.t2t.mem.dto.MileDTO" parameterType="string">
        SELECT
            MI.USRID
            ,MI.POINT
            ,MI.REGDT
            ,MI.LASTDT
        FROM
            MEM M LEFT OUTER JOIN MILES MI
            ON M.USRID = MI.USRID
        WHERE
            M.USRID =#{usrId}
    </select>
    <!-- 나의 신고내역 -->
    <select id="selectComplaintList" parameterType="string" resultType="org.t2t.mem.dto.ComplaintDTO">
        SELECT
            C.*
        FROM PRD R LEFT OUTER JOIN CMP C
        ON R.PRDID = C.PRDID
        WHERE
            R.USRID = #{usrId}
    </select>
    <!-- 나의 구매내역 -->
    <select id="selectOrderList" resultType="org.t2t.prd.dto.ProductDTO">
        SELECT
        O.ORDID, O.ORDDT, O.PRDID, P.PRDID, P.TITLE, P.CONT, P.PRICE
        FROM ORD O JOIN PRD P
        ON O.PRDID = P.PRDID
        WHERE
        O.USRID ='test2' AND
        P.SALSTAT = 'PRD01' AND
        P.USRID != #{usrId};
    </select>
    <!-- 나의 거래내역(판매상태에 따른) -->
    <select id="selectTradeList" resultType="org.t2t.prd.dto.ProductDTO">
        SELECT P.SALSTAT, P.PRDID, P.USRID ,P.PRDID, P.TITLE, P.CONT, P.PRICE
        FROM PRD P, MEM M
        WHERE
        P.SALSTAT='PRD01' AND
        P.USRID='test2'  AND
        M.USRID != #{usrId};
    </select>

    <select id="selectMileByUsrId" resultType="org.t2t.mem.dto.MileDTO">
        SELECT * FROM MILES
        WHERE
            USRID = #{usrId}
    </select>

    <select id="selectRankByUsrId" resultType="org.t2t.mem.dto.RankingDTO">
        SELECT
            USRID,
            SCORE,
            LASTACTDT,
            REGDT,
            LASTDT
        FROM RANKING
        WHERE
        USRID = #{usrId}
    </select>

</mapper>