<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.t2t.mem.repository.MemberMapper">
    <!-- 회원 1명 정보 조회 -->
    <select id="findByID" resultType="org.t2t.mem.dto.MemberDTO">
        SELECT * FROM MEM WHERE USRID=#{usrId}
    </select>
    <!-- 회원 전체 조회 -->
    <select id="findList" resultType="org.t2t.mem.dto.MemberDTO">
        SELECT * FROM MEM
    </select>
    <update id="updateMem">
        UPDATE MEM
            SET NM=#{nm},
            EMAIL=#{email},
            INTRO=#{intro}
        WHERE
            USRID = #{usrId}
    </update>
    <!-- 회원 탈퇴 -->
    <delete id="deleteMem">
        DELETE FROM MEM
        WHERE
            USRID = #{usrId}
    </delete>
    <!-- 마일리지 충전 / 환전 -->
    <insert id="updateMile" parameterType="org.t2t.mem.dto.MileDTO">
        UPDATE MILES
        SET POINT =
        <choose>
            <when test="option == 'TRD01'">
                #{point} + POINT
            </when>
            <otherwise>
                POINT - #{point}
            </otherwise>
        </choose>
        WHERE
        USRID = #{usrId}
    </insert>

    <select id="selectMileTotal" resultType="org.t2t.mem.dto.MileDTO" parameterType="string">
        SELECT
            MI.USRID
            ,MI.POINT
            ,MI.REGDT
            ,MI.LASTDT
        FROM
            MEM M LEFT OUTER JOIN MILES MI
            ON M.USRID = MI.USRID
        WHERE
            M.USRID =#{usrId}
    </select>
    <select id="selectComplaintList" parameterType="string" resultType="org.t2t.mem.dto.CmpDTO">
        SELECT
            C.*
        FROM PRD R LEFT OUTER JOIN CMP C
        ON R.PRDID = C.PRDID
        WHERE
            R.USRID = #{usrId}
    </select>
</mapper>